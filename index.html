<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="theme-color" content="#070a10" />
    <title>Ultimate Sudoku</title>

    <!-- PWA -->
    <link rel="manifest" href="./manifest.webmanifest" />
    <link rel="icon" href="./icon.svg" type="image/svg+xml" />

    <!-- iOS basics -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ultimate Sudoku">
    <link rel="apple-touch-icon" href="./icon-192.png" />
    <meta name="mobile-web-app-capable" content="yes">

    <link rel="stylesheet" href="./styles.css" />
</head>

<body>
    <div class="app">
        <header class="topbar">
            <div class="brand">
                <div class="logo" aria-hidden="true"></div>
                <div class="brand-text">
                    <div class="title">Ultimate Sudoku</div>
                    <div class="subtitle" id="subtitle">Offline • System theme • Daily Challenge</div>
                </div>
            </div>

            <div class="top-actions">
                <button class="btn" id="btnDaily" type="button">Daily</button>
                <button class="btn" id="btnNew" type="button">New</button>
                <button class="btn ghost" id="btnMenu" type="button" aria-haspopup="dialog"
                    aria-controls="sheet">Menu</button>
            </div>
        </header>

        <main class="main">
            <section class="board-wrap">
                <div class="board-card">
                    <div class="board-header">
                        <div class="pill" id="pillMode">Mode: Smart</div>
                        <div class="pill" id="pillDiff">Difficulty: —</div>
                        <div class="pill" id="pillTimer">00:00</div>
                    </div>

                    <div class="board" id="board" aria-label="Sudoku board"></div>

                    <div class="board-footer">
                        <div class="toggles">
                            <label class="toggle">
                                <input id="toggleConflicts" type="checkbox" checked />
                                <span>Conflicts</span>
                            </label>
                            <label class="toggle">
                                <input id="toggleAutoNotes" type="checkbox" />
                                <span>Auto-notes</span>
                            </label>
                        </div>

                        <div class="mini">
                            <div class="mini-label">Progress</div>
                            <div class="mini-bar">
                                <div class="mini-fill" id="progressFill"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <aside class="controls">
                <div class="control-card">
                    <div class="row">
                        <button class="btn" id="btnNotes" type="button">Notes: Off</button>
                        <button class="btn" id="btnErase" type="button">Erase</button>
                        <button class="btn" id="btnUndo" type="button">Undo</button>
                        <button class="btn" id="btnRedo" type="button">Redo</button>
                    </div>

                    <div class="row compact">
                        <button class="btn" id="btnRestart" type="button">Restart</button>
                        <button class="btn" id="btnPause" type="button">Pause</button>
                        <div class="status" id="statusText">Tap a cell to begin.</div>
                    </div>

                    <div class="keypad" id="keypad" aria-label="Number pad"></div>
                </div>
            </aside>
        </main>
    </div>

    <!-- Bottom sheet -->
    <div class="sheet-backdrop" id="sheetBackdrop" hidden></div>
    <div class="sheet" id="sheet" hidden aria-hidden="true" role="dialog" aria-label="Menu">
        <div class="sheet-handle" id="sheetHandle"></div>
        <div class="sheet-content">
            <div class="sheet-title">Menu</div>

            <div class="sheet-group">
                <div class="sheet-label">Play</div>
                <div class="grid-2">
                    <button class="btn" id="menuDaily" type="button">Daily Challenge</button>
                    <button class="btn" data-new="smart" type="button">Smart (Adaptive)</button>
                    <button class="btn" data-new="moderate" type="button">Moderate</button>
                    <button class="btn" data-new="hard" type="button">Hard</button>
                    <button class="btn" data-new="pro" type="button">Pro</button>
                </div>
                <div class="hint">Smart mode adapts using solve time + mistakes. Daily Challenge works fully offline.
                </div>

                <!-- APK download (Android mobile only, hides when PWA installed or already clicked) -->
                <div style="margin-top:12px">
                    <button class="btn" id="btnDownloadApk" type="button" style="display:none">
                        Download Android App (APK)
                    </button>
                    <div class="hint" id="apkHint" style="display:none">
                        If your phone asks, allow downloads from your browser. After installing, this button will
                        disappear.
                    </div>
                </div>
            </div>

            <div class="sheet-group">
                <div class="sheet-label">Options</div>
                <div class="grid-2">
                    <button class="btn" id="btnClearNotes" type="button">Clear notes</button>
                    <button class="btn" id="btnClearAll" type="button">Clear all user input</button>
                </div>
            </div>

            <div class="sheet-group">
                <div class="sheet-label">Daily</div>
                <div class="stats" id="dailyBox"></div>
            </div>

            <div class="sheet-group">
                <div class="sheet-label">Stats</div>
                <div class="stats" id="statsBox"></div>
                <div style="margin-top:10px">
                    <button class="btn" id="btnResetStats" type="button">Reset stats</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Win modal -->
    <div class="modal-backdrop" id="modalBackdrop" hidden></div>
    <div class="modal" id="modalWin" hidden>
        <div class="modal-title" id="winTitle">Puzzle complete</div>
        <div class="modal-body" id="winBody"></div>
        <div class="modal-actions">
            <button class="btn ghost" id="btnCloseWin" type="button">Close</button>
            <button class="btn" id="btnNextSmart" type="button">Next (Smart)</button>
        </div>
    </div>

    <!-- FX layer -->
    <canvas id="fxCanvas" style="position:fixed;inset:0;pointer-events:none;z-index:9999;"></canvas>

    <!-- Big center win banner -->
    <div id="winBanner" class="win-banner" hidden>
        <div class="win-banner-title" id="winBannerTitle">YOU WON!</div>
        <div class="win-banner-sub" id="winBannerSub">Time: 00:00 • Mistakes: 0</div>
    </div>

    <script>
        window.__PWA_INSTALLED__ =
            window.matchMedia("(display-mode: standalone)").matches ||
            window.matchMedia("(display-mode: fullscreen)").matches ||
            window.navigator.standalone === true;

        if ("serviceWorker" in navigator) {
            window.addEventListener("load", async () => {
                try {
                    await navigator.serviceWorker.register("./sw.js", { scope: "./" });
                } catch (e) {
                    console.log("SW register failed:", e);
                }
            });
        }

        window.addEventListener("appinstalled", () => {
            window.__PWA_INSTALLED__ = true;
        });
    </script>

    <script defer src="./app.js"></script>
</body>

</html>